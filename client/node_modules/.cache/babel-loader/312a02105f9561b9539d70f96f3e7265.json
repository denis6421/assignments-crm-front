{"ast":null,"code":"import _defineProperty from \"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/denis/Desktop/projects/todo/front/client/src/components/employee-page/employee-assignments/EmploeeAssignments.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { apiGetRequest, apiPostRequest } from \"../../../tools/api\";\nimport EmployeeTodoList from \"./EmployeeTodoList\";\nimport { withRouter } from \"react-router\";\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport { EMPLOYEE_ROUTE, EMPLOYEE_ASSIGNMENT_ROUTE, EMPLOYEE_DASHBOARD_PAGE_ROUTE, EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE, PERSONAL_ASSIGNMENTS_ROUTE, PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT } from \"../../../tools/routes\";\nimport EmployeeAssignmentPage from \"../employee-assignment-page/EmployeeAssignmentPage\";\nimport HandleAssignment from \"../../assignments/parts/HandleAssignment\";\nimport AssignmentComments from \"../parts/AssignmentComments\";\nimport PopupWithFunction from \"../../../parts/PopupWithFunction\";\nimport moment from 'moment';\n\nclass EmploeeAssignments extends Component {\n  constructor() {\n    super();\n\n    this.getAssignments = async () => {\n      const api = \"assignment\";\n      const res = await apiGetRequest(api);\n\n      if (res.ok) {\n        this.setState({\n          assignments_list: res.result,\n          assignments_loaded: true\n        });\n      }\n    };\n\n    this.handleAssignment = (action, new_assignment, assignment_to_edit) => {\n      this.setState({\n        handle_assignment: action,\n        new_assignment,\n        assignment_to_edit\n      });\n    };\n\n    this.createAndUpdateAssignment = async assignment => {\n      const _this$props = this.props,\n            employee = _this$props.employee,\n            manager_assignments = _this$props.manager_assignments;\n      const api = \"employee_assignment\";\n      assignment[\"employee_id\"] = employee._id;\n      assignment[\"status\"] = assignment.status ? assignment.status : \"pending\";\n      assignment[\"deadline\"] = assignment.deadline ? assignment.deadline : moment().toDate();\n      console.log(assignment);\n      const res = await apiPostRequest(api, assignment);\n\n      if (res.ok) {\n        let index = employee.assignments.findIndex(m => m._id == assignment._id);\n        let updated_employee = JSON.parse(JSON.stringify(employee));\n\n        if (index >= 0) {\n          updated_employee.assignments.splice(index, 1, res.result);\n          this.props.updateGlobalReducer(\"success\", \"Assignment updated\");\n        } else {\n          updated_employee.assignments.unshift(res.result);\n          this.props.updateGlobalReducer(\"success\", \"Assignment created\");\n        }\n\n        if (manager_assignments) {\n          this.props.updateUserReducer('user', updated_employee);\n        } else {\n          this.props.updateParentState('employee', updated_employee);\n        }\n\n        const url = window.location.pathname;\n\n        if (url.indexOf('assignment') > -1) {\n          this.updateAssignmentInAssignmentPage(res.result);\n        }\n      }\n    };\n\n    this.handleDelete = assignment_to_remove => {\n      console.log(assignment_to_remove);\n      this.setState({\n        assignment_to_remove\n      });\n    };\n\n    this.handleAssignmentComments = assignment_comments => {\n      this.setState({\n        assignment_comments\n      });\n    };\n\n    this.remove = async () => {\n      const _this$state = this.state,\n            assignment_to_remove = _this$state.assignment_to_remove,\n            manager_assignments = _this$state.manager_assignments;\n      const employee = this.props.employee;\n      this.setState({\n        delete_loading: true\n      });\n      assignment_to_remove[\"employee_id\"] = employee._id;\n      const api = \"employee_assignment/delete\";\n      const res = await apiPostRequest(api, assignment_to_remove);\n\n      if (res.ok) {\n        let updated = _objectSpread({}, employee);\n\n        let index = updated.assignments.findIndex(m => m._id == assignment_to_remove._id);\n\n        if (index >= 0) {\n          updated.assignments.splice(index, 1);\n\n          if (manager_assignments) {\n            this.props.updateUserReducer('user', updated);\n          } else {\n            this.props.updateEmployee(updated);\n          }\n\n          this.close();\n        }\n\n        const url = window.location.pathname;\n\n        if (url.indexOf('assignment') === 0) {\n          this.props.history.push(EMPLOYEE_ROUTE.replace(':id', employee._id));\n        }\n      }\n\n      setTimeout(() => {\n        this.setState({\n          delete_loading: false\n        });\n      }, 300);\n    };\n\n    this.close = () => {\n      this.handleDelete();\n    };\n\n    this.updateAssignmentInAssignmentPage = page_assignment => {\n      this.setState({\n        page_assignment\n      });\n    };\n\n    this.updateState = (name, value) => {\n      this.setState({\n        [name]: value\n      });\n    };\n\n    this.state = {};\n  }\n\n  async componentDidMount() {\n    this.getAssignments();\n  }\n\n  render() {\n    const _this$state2 = this.state,\n          assignments_list = _this$state2.assignments_list,\n          assignments_loaded = _this$state2.assignments_loaded,\n          assignment_comments = _this$state2.assignment_comments,\n          handle_assignment = _this$state2.handle_assignment,\n          new_assignment = _this$state2.new_assignment,\n          assignment_to_edit = _this$state2.assignment_to_edit,\n          assignment_to_remove = _this$state2.assignment_to_remove,\n          page_assignment = _this$state2.page_assignment,\n          delete_loading = _this$state2.delete_loading;\n    const system_text = this.props.global.system_text;\n    const _this$props2 = this.props,\n          active_section = _this$props2.active_section,\n          employee = _this$props2.employee,\n          hide_page = _this$props2.hide_page,\n          manager_assignments = _this$props2.manager_assignments;\n    const user = this.props.user.user;\n    return React.createElement(\"div\", {\n      style: {\n        opacity: hide_page ? 0 : 1,\n        transition: '0.2s all'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167\n      },\n      __self: this\n    }, React.createElement(PopupWithFunction, {\n      text: system_text.REMOVE_ASSIGNMENT_QUESTION,\n      name: \"\".concat(assignment_to_remove ? assignment_to_remove.title : \"\", \"?\"),\n      active: assignment_to_remove,\n      submit: this.remove,\n      close: this.close,\n      submit_text: system_text.YES,\n      close_text: system_text.NO,\n      loading: delete_loading,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), assignment_comments ? React.createElement(AssignmentComments, {\n      updateAssignment: this.createAndUpdateAssignment,\n      assignment: assignment_comments,\n      updateParentState: this.updateState,\n      system_text: system_text,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183\n      },\n      __self: this\n    }) : \"\", handle_assignment ? React.createElement(HandleAssignment, {\n      new_assignment: new_assignment,\n      edit: this.createAndUpdateAssignment,\n      create: this.createAndUpdateAssignment,\n      assignment_to_edit: assignment_to_edit,\n      toggleHandleAssignment: this.handleAssignment,\n      from_employee_page: true,\n      handleDelete: this.handleDelete,\n      assignments_list: assignments_list,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }) : null, manager_assignments ? React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, React.createElement(Route, {\n      exact: true,\n      path: PERSONAL_ASSIGNMENTS_ROUTE,\n      render: () => React.createElement(EmployeeTodoList, {\n        manager_assignments: manager_assignments,\n        handleAssignmentComments: this.handleAssignmentComments,\n        handleAssignment: this.handleAssignment,\n        updateEmployee: this.updateEmployee,\n        employee: employee ? employee : {},\n        assignments_loaded: assignments_loaded,\n        createAndUpdateAssignment: this.createAndUpdateAssignment,\n        handleDelete: this.handleDelete,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }), React.createElement(Route, {\n      exact: true,\n      path: PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT,\n      render: () => React.createElement(EmployeeAssignmentPage, {\n        employee: employee,\n        manager_assignments: manager_assignments,\n        active_section: active_section,\n        handleAssignment: this.handleAssignment,\n        handleDelete: this.handleDelete,\n        assignment: page_assignment,\n        updateAssignmentInAssignmentPage: this.updateAssignmentInAssignmentPage,\n        createAndUpdateAssignment: this.createAndUpdateAssignment,\n        handleAssignmentComments: this.handleAssignmentComments,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    })) : React.createElement(Switch, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }, React.createElement(Route, {\n      exact: true,\n      path: user.is_manager ? EMPLOYEE_ROUTE : EMPLOYEE_DASHBOARD_PAGE_ROUTE,\n      render: () => React.createElement(EmployeeTodoList, {\n        handleAssignmentComments: this.handleAssignmentComments,\n        handleAssignment: this.handleAssignment,\n        updateEmployee: this.updateEmployee,\n        employee: employee ? employee : {},\n        assignments_loaded: assignments_loaded,\n        createAndUpdateAssignment: this.createAndUpdateAssignment,\n        handleDelete: this.handleDelete,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 249\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }), React.createElement(Route, {\n      exact: true,\n      path: user.is_manager ? EMPLOYEE_ASSIGNMENT_ROUTE : EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,\n      render: () => React.createElement(EmployeeAssignmentPage, {\n        employee: employee,\n        active_section: active_section,\n        handleAssignment: this.handleAssignment,\n        handleDelete: this.handleDelete,\n        assignment: page_assignment,\n        updateAssignmentInAssignmentPage: this.updateAssignmentInAssignmentPage,\n        createAndUpdateAssignment: this.createAndUpdateAssignment,\n        handleAssignmentComments: this.handleAssignmentComments,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 264\n        },\n        __self: this\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 260\n      },\n      __self: this\n    })));\n  }\n\n}\n\nfunction mapStateToProps({\n  employees,\n  navbar,\n  assignments,\n  user,\n  global\n}) {\n  return {\n    employees,\n    navbar,\n    assignments,\n    user,\n    global\n  };\n}\n\nexport default withRouter(connect(mapStateToProps, actions)(EmploeeAssignments));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/components/employee-page/employee-assignments/EmploeeAssignments.jsx"],"names":["React","Component","connect","actions","apiGetRequest","apiPostRequest","EmployeeTodoList","withRouter","BrowserRouter","Router","Route","Switch","EMPLOYEE_ROUTE","EMPLOYEE_ASSIGNMENT_ROUTE","EMPLOYEE_DASHBOARD_PAGE_ROUTE","EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE","PERSONAL_ASSIGNMENTS_ROUTE","PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT","EmployeeAssignmentPage","HandleAssignment","AssignmentComments","PopupWithFunction","moment","EmploeeAssignments","constructor","getAssignments","api","res","ok","setState","assignments_list","result","assignments_loaded","handleAssignment","action","new_assignment","assignment_to_edit","handle_assignment","createAndUpdateAssignment","assignment","props","employee","manager_assignments","_id","status","deadline","toDate","console","log","index","assignments","findIndex","m","updated_employee","JSON","parse","stringify","splice","updateGlobalReducer","unshift","updateUserReducer","updateParentState","url","window","location","pathname","indexOf","updateAssignmentInAssignmentPage","handleDelete","assignment_to_remove","handleAssignmentComments","assignment_comments","remove","state","delete_loading","updated","updateEmployee","close","history","push","replace","setTimeout","page_assignment","updateState","name","value","componentDidMount","render","system_text","global","active_section","hide_page","user","opacity","transition","REMOVE_ASSIGNMENT_QUESTION","title","YES","NO","is_manager","mapStateToProps","employees","navbar"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,OAAO,KAAKC,OAAZ,MAAyB,0BAAzB;AACA,SAASC,aAAT,EAAwBC,cAAxB,QAA8C,oBAA9C;AACA,OAAOC,gBAAP,MAA6B,oBAA7B;AACA,SAASC,UAAT,QAA2B,cAA3B;AACA,SAASC,aAAa,IAAIC,MAA1B,EAAkCC,KAAlC,EAAyCC,MAAzC,QAAuD,kBAAvD;AACA,SACEC,cADF,EAEEC,yBAFF,EAGEC,6BAHF,EAIEC,mCAJF,EAKEC,0BALF,EAMEC,qCANF,QAOO,uBAPP;AAQA,OAAOC,sBAAP,MAAmC,oDAAnC;AACA,OAAOC,gBAAP,MAA6B,0CAA7B;AACA,OAAOC,kBAAP,MAA+B,6BAA/B;AACA,OAAOC,iBAAP,MAA8B,kCAA9B;AACA,OAAOC,MAAP,MAAmB,QAAnB;;AACA,MAAMC,kBAAN,SAAiCtB,SAAjC,CAA2C;AACzCuB,EAAAA,WAAW,GAAG;AACZ;;AADY,SAUdC,cAVc,GAUG,YAAY;AAC3B,YAAMC,GAAG,GAAG,YAAZ;AACA,YAAMC,GAAG,GAAG,MAAMvB,aAAa,CAACsB,GAAD,CAA/B;;AACA,UAAIC,GAAG,CAACC,EAAR,EAAY;AACV,aAAKC,QAAL,CAAc;AACZC,UAAAA,gBAAgB,EAAEH,GAAG,CAACI,MADV;AAEZC,UAAAA,kBAAkB,EAAE;AAFR,SAAd;AAID;AACF,KAnBa;;AAAA,SAsBdC,gBAtBc,GAsBK,CAACC,MAAD,EAASC,cAAT,EAAyBC,kBAAzB,KAAgD;AACjE,WAAKP,QAAL,CAAc;AACZQ,QAAAA,iBAAiB,EAAEH,MADP;AAEZC,QAAAA,cAFY;AAGZC,QAAAA;AAHY,OAAd;AAKD,KA5Ba;;AAAA,SA8BdE,yBA9Bc,GA8Bc,MAAOC,UAAP,IAAsB;AAAA,0BACN,KAAKC,KADC;AAAA,YACxCC,QADwC,eACxCA,QADwC;AAAA,YAC9BC,mBAD8B,eAC9BA,mBAD8B;AAEhD,YAAMhB,GAAG,wBAAT;AACAa,MAAAA,UAAU,CAAC,aAAD,CAAV,GAA4BE,QAAQ,CAACE,GAArC;AACAJ,MAAAA,UAAU,CAAC,QAAD,CAAV,GAAuBA,UAAU,CAACK,MAAX,GAAoBL,UAAU,CAACK,MAA/B,GAAwC,SAA/D;AACAL,MAAAA,UAAU,CAAC,UAAD,CAAV,GAAyBA,UAAU,CAACM,QAAX,GAAsBN,UAAU,CAACM,QAAjC,GAA4CvB,MAAM,GAAGwB,MAAT,EAArE;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYT,UAAZ;AACA,YAAMZ,GAAG,GAAG,MAAMtB,cAAc,CAACqB,GAAD,EAAMa,UAAN,CAAhC;;AACA,UAAIZ,GAAG,CAACC,EAAR,EAAY;AACV,YAAIqB,KAAK,GAAGR,QAAQ,CAACS,WAAT,CAAqBC,SAArB,CACTC,CAAD,IAAOA,CAAC,CAACT,GAAF,IAASJ,UAAU,CAACI,GADjB,CAAZ;AAGA,YAAIU,gBAAgB,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAef,QAAf,CAAX,CAAvB;;AACA,YAAIQ,KAAK,IAAI,CAAb,EAAgB;AACdI,UAAAA,gBAAgB,CAACH,WAAjB,CAA6BO,MAA7B,CAAoCR,KAApC,EAA2C,CAA3C,EAA8CtB,GAAG,CAACI,MAAlD;AACA,eAAKS,KAAL,CAAWkB,mBAAX,CAA+B,SAA/B,EAA0C,oBAA1C;AACD,SAHD,MAGO;AACLL,UAAAA,gBAAgB,CAACH,WAAjB,CAA6BS,OAA7B,CAAqChC,GAAG,CAACI,MAAzC;AACA,eAAKS,KAAL,CAAWkB,mBAAX,CAA+B,SAA/B,EAA0C,oBAA1C;AACD;;AACD,YAAGhB,mBAAH,EAAuB;AACrB,eAAKF,KAAL,CAAWoB,iBAAX,CAA6B,MAA7B,EAAqCP,gBAArC;AACD,SAFD,MAEK;AACH,eAAKb,KAAL,CAAWqB,iBAAX,CAA6B,UAA7B,EAAwCR,gBAAxC;AACD;;AAED,cAAMS,GAAG,GAAGC,MAAM,CAACC,QAAP,CAAgBC,QAA5B;;AACA,YAAGH,GAAG,CAACI,OAAJ,CAAY,YAAZ,IAA4B,CAAC,CAAhC,EAAkC;AAChC,eAAKC,gCAAL,CAAsCxC,GAAG,CAACI,MAA1C;AACH;AACA;AACF,KA7Da;;AAAA,SA+DdqC,YA/Dc,GA+DEC,oBAAD,IAA0B;AACvCtB,MAAAA,OAAO,CAACC,GAAR,CAAYqB,oBAAZ;AACA,WAAKxC,QAAL,CAAc;AACZwC,QAAAA;AADY,OAAd;AAGD,KApEa;;AAAA,SAqEdC,wBArEc,GAqEcC,mBAAD,IAAyB;AAClD,WAAK1C,QAAL,CAAc;AACZ0C,QAAAA;AADY,OAAd;AAGD,KAzEa;;AAAA,SA2EdC,MA3Ec,GA2EL,YAAY;AAAA,0BACmC,KAAKC,KADxC;AAAA,YACXJ,oBADW,eACXA,oBADW;AAAA,YACW3B,mBADX,eACWA,mBADX;AAAA,YAEXD,QAFW,GAEE,KAAKD,KAFP,CAEXC,QAFW;AAGnB,WAAKZ,QAAL,CAAc;AACZ6C,QAAAA,cAAc,EAAC;AADH,OAAd;AAGAL,MAAAA,oBAAoB,CAAC,aAAD,CAApB,GAAsC5B,QAAQ,CAACE,GAA/C;AACA,YAAMjB,GAAG,GAAG,4BAAZ;AACA,YAAMC,GAAG,GAAG,MAAMtB,cAAc,CAACqB,GAAD,EAAM2C,oBAAN,CAAhC;;AACA,UAAI1C,GAAG,CAACC,EAAR,EAAY;AACV,YAAI+C,OAAO,qBAAQlC,QAAR,CAAX;;AACA,YAAIQ,KAAK,GAAG0B,OAAO,CAACzB,WAAR,CAAoBC,SAApB,CACTC,CAAD,IAAOA,CAAC,CAACT,GAAF,IAAS0B,oBAAoB,CAAC1B,GAD3B,CAAZ;;AAGA,YAAIM,KAAK,IAAI,CAAb,EAAgB;AACd0B,UAAAA,OAAO,CAACzB,WAAR,CAAoBO,MAApB,CAA2BR,KAA3B,EAAkC,CAAlC;;AACA,cAAGP,mBAAH,EAAuB;AACrB,iBAAKF,KAAL,CAAWoB,iBAAX,CAA6B,MAA7B,EAAqCe,OAArC;AACD,WAFD,MAEK;AACH,iBAAKnC,KAAL,CAAWoC,cAAX,CAA0BD,OAA1B;AACD;;AAED,eAAKE,KAAL;AACD;;AACD,cAAMf,GAAG,GAAGC,MAAM,CAACC,QAAP,CAAgBC,QAA5B;;AACA,YAAGH,GAAG,CAACI,OAAJ,CAAY,YAAZ,MAA8B,CAAjC,EAAmC;AAC/B,eAAK1B,KAAL,CAAWsC,OAAX,CAAmBC,IAAnB,CAAwBnE,cAAc,CAACoE,OAAf,CAAuB,KAAvB,EAA8BvC,QAAQ,CAACE,GAAvC,CAAxB;AACH;AACF;;AACHsC,MAAAA,UAAU,CAAC,MAAM;AACf,aAAKpD,QAAL,CAAc;AACZ6C,UAAAA,cAAc,EAAC;AADH,SAAd;AAGD,OAJS,EAIP,GAJO,CAAV;AAKC,KA7Ga;;AAAA,SA+GdG,KA/Gc,GA+GN,MAAM;AACZ,WAAKT,YAAL;AACD,KAjHa;;AAAA,SAoHhBD,gCApHgB,GAoHoBe,eAAD,IAAqB;AACpD,WAAKrD,QAAL,CAAc;AACVqD,QAAAA;AADU,OAAd;AAGH,KAxHe;;AAAA,SAyHhBC,WAzHgB,GAyHF,CAACC,IAAD,EAAOC,KAAP,KAAiB;AAC3B,WAAKxD,QAAL,CAAc;AACV,SAACuD,IAAD,GAAOC;AADG,OAAd;AAGH,KA7He;;AAEZ,SAAKZ,KAAL,GAAa,EAAb;AACD;;AAED,QAAMa,iBAAN,GAA0B;AAExB,SAAK7D,cAAL;AACD;;AAuHD8D,EAAAA,MAAM,GAAG;AAAA,yBAWH,KAAKd,KAXF;AAAA,UAEL3C,gBAFK,gBAELA,gBAFK;AAAA,UAGLE,kBAHK,gBAGLA,kBAHK;AAAA,UAILuC,mBAJK,gBAILA,mBAJK;AAAA,UAKLlC,iBALK,gBAKLA,iBALK;AAAA,UAMLF,cANK,gBAMLA,cANK;AAAA,UAOLC,kBAPK,gBAOLA,kBAPK;AAAA,UAQLiC,oBARK,gBAQLA,oBARK;AAAA,UASLa,eATK,gBASLA,eATK;AAAA,UAULR,cAVK,gBAULA,cAVK;AAAA,UAYAc,WAZA,GAYe,KAAKhD,KAAL,CAAWiD,MAZ1B,CAYAD,WAZA;AAAA,yBAa8D,KAAKhD,KAbnE;AAAA,UAaCkD,cAbD,gBAaCA,cAbD;AAAA,UAaiBjD,QAbjB,gBAaiBA,QAbjB;AAAA,UAa2BkD,SAb3B,gBAa2BA,SAb3B;AAAA,UAasCjD,mBAbtC,gBAasCA,mBAbtC;AAAA,UAeAkD,IAfA,GAeQ,KAAKpD,KAAL,CAAWoD,IAfnB,CAeAA,IAfA;AAiBP,WACE;AACA,MAAA,KAAK,EAAG;AACNC,QAAAA,OAAO,EAACF,SAAS,GAAG,CAAH,GAAO,CADlB;AAENG,QAAAA,UAAU,EAAC;AAFL,OADR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKA,oBAAC,iBAAD;AACI,MAAA,IAAI,EAAEN,WAAW,CAACO,0BADtB;AAEI,MAAA,IAAI,YAAK1B,oBAAoB,GAAGA,oBAAoB,CAAC2B,KAAxB,GAAgC,EAAzD,MAFR;AAGI,MAAA,MAAM,EAAE3B,oBAHZ;AAII,MAAA,MAAM,EAAE,KAAKG,MAJjB;AAKI,MAAA,KAAK,EAAE,KAAKK,KALhB;AAMI,MAAA,WAAW,EAAEW,WAAW,CAACS,GAN7B;AAOI,MAAA,UAAU,EAAET,WAAW,CAACU,EAP5B;AAQI,MAAA,OAAO,EAAIxB,cARf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MALA,EAeGH,mBAAmB,GAClB,oBAAC,kBAAD;AACE,MAAA,gBAAgB,EAAE,KAAKjC,yBADzB;AAEE,MAAA,UAAU,EAAEiC,mBAFd;AAGE,MAAA,iBAAiB,EAAE,KAAKY,WAH1B;AAIE,MAAA,WAAW,EAAIK,WAJjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADkB,GAQlB,EAvBJ,EAyBGnD,iBAAiB,GAChB,oBAAC,gBAAD;AACE,MAAA,cAAc,EAAEF,cADlB;AAEE,MAAA,IAAI,EAAE,KAAKG,yBAFb;AAGE,MAAA,MAAM,EAAE,KAAKA,yBAHf;AAIE,MAAA,kBAAkB,EAAEF,kBAJtB;AAKE,MAAA,sBAAsB,EAAE,KAAKH,gBAL/B;AAME,MAAA,kBAAkB,EAAE,IANtB;AAOE,MAAA,YAAY,EAAI,KAAKmC,YAPvB;AAQE,MAAA,gBAAgB,EAAItC,gBARtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADgB,GAYd,IArCN,EAwCIY,mBAAmB,GAEnB,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA,oBAAC,KAAD;AACE,MAAA,KAAK,MADP;AAEE,MAAA,IAAI,EAAE1B,0BAFR;AAGE,MAAA,MAAM,EAAE,MACN,oBAAC,gBAAD;AACA,QAAA,mBAAmB,EAAI0B,mBADvB;AAEE,QAAA,wBAAwB,EAAE,KAAK4B,wBAFjC;AAGE,QAAA,gBAAgB,EAAE,KAAKrC,gBAHzB;AAIE,QAAA,cAAc,EAAE,KAAK2C,cAJvB;AAKE,QAAA,QAAQ,EAAEnC,QAAQ,GAAGA,QAAH,GAAc,EALlC;AAME,QAAA,kBAAkB,EAAET,kBANtB;AAOE,QAAA,yBAAyB,EAAI,KAAKM,yBAPpC;AAQE,QAAA,YAAY,EAAI,KAAK8B,YARvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADA,EAiBA,oBAAC,KAAD;AACC,MAAA,KAAK,MADN;AAEE,MAAA,IAAI,EAAEnD,qCAFR;AAGE,MAAA,MAAM,EAAE,MACN,oBAAC,sBAAD;AACE,QAAA,QAAQ,EAAEwB,QADZ;AAEE,QAAA,mBAAmB,EAAIC,mBAFzB;AAGE,QAAA,cAAc,EAAEgD,cAHlB;AAIE,QAAA,gBAAgB,EAAE,KAAKzD,gBAJzB;AAKE,QAAA,YAAY,EAAI,KAAKmC,YALvB;AAME,QAAA,UAAU,EAAIc,eANhB;AAOE,QAAA,gCAAgC,EAAI,KAAKf,gCAP3C;AAQE,QAAA,yBAAyB,EAAI,KAAK7B,yBARpC;AASE,QAAA,wBAAwB,EAAI,KAAKgC,wBATnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAjBA,CAFmB,GAqCnB,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACA,oBAAC,KAAD;AACE,MAAA,KAAK,MADP;AAEE,MAAA,IAAI,EAAEsB,IAAI,CAACO,UAAL,GAAkBvF,cAAlB,GAAqCE,6BAF7C;AAGE,MAAA,MAAM,EAAE,MACN,oBAAC,gBAAD;AACE,QAAA,wBAAwB,EAAE,KAAKwD,wBADjC;AAEE,QAAA,gBAAgB,EAAE,KAAKrC,gBAFzB;AAGE,QAAA,cAAc,EAAE,KAAK2C,cAHvB;AAIE,QAAA,QAAQ,EAAEnC,QAAQ,GAAGA,QAAH,GAAc,EAJlC;AAKE,QAAA,kBAAkB,EAAET,kBALtB;AAME,QAAA,yBAAyB,EAAI,KAAKM,yBANpC;AAOE,QAAA,YAAY,EAAI,KAAK8B,YAPvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADA,EAgBA,oBAAC,KAAD;AACC,MAAA,KAAK,MADN;AAEE,MAAA,IAAI,EAAEwB,IAAI,CAACO,UAAL,GAAkBtF,yBAAlB,GAA8CE,mCAFtD;AAGE,MAAA,MAAM,EAAE,MACN,oBAAC,sBAAD;AACE,QAAA,QAAQ,EAAE0B,QADZ;AAEE,QAAA,cAAc,EAAEiD,cAFlB;AAGE,QAAA,gBAAgB,EAAE,KAAKzD,gBAHzB;AAIE,QAAA,YAAY,EAAI,KAAKmC,YAJvB;AAKE,QAAA,UAAU,EAAIc,eALhB;AAME,QAAA,gCAAgC,EAAI,KAAKf,gCAN3C;AAOE,QAAA,yBAAyB,EAAI,KAAK7B,yBAPpC;AAQE,QAAA,wBAAwB,EAAI,KAAKgC,wBARnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAJJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MAhBA,CA7EJ,CADF;AAiHD;;AAlQwC;;AAqQ3C,SAAS8B,eAAT,CAAyB;AAAEC,EAAAA,SAAF;AAAaC,EAAAA,MAAb;AAAqBpD,EAAAA,WAArB;AAAkC0C,EAAAA,IAAlC;AAAwCH,EAAAA;AAAxC,CAAzB,EAA2E;AACzE,SAAO;AAAEY,IAAAA,SAAF;AAAaC,IAAAA,MAAb;AAAqBpD,IAAAA,WAArB;AAAkC0C,IAAAA,IAAlC;AAAyCH,IAAAA;AAAzC,GAAP;AACD;;AAED,eAAelF,UAAU,CACvBL,OAAO,CAACkG,eAAD,EAAkBjG,OAAlB,CAAP,CAAkCoB,kBAAlC,CADuB,CAAzB","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { apiGetRequest, apiPostRequest } from \"../../../tools/api\";\nimport EmployeeTodoList from \"./EmployeeTodoList\";\nimport { withRouter } from \"react-router\";\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport {\n  EMPLOYEE_ROUTE,\n  EMPLOYEE_ASSIGNMENT_ROUTE,\n  EMPLOYEE_DASHBOARD_PAGE_ROUTE,\n  EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,\n  PERSONAL_ASSIGNMENTS_ROUTE,\n  PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT\n} from \"../../../tools/routes\";\nimport EmployeeAssignmentPage from \"../employee-assignment-page/EmployeeAssignmentPage\";\nimport HandleAssignment from \"../../assignments/parts/HandleAssignment\";\nimport AssignmentComments from \"../parts/AssignmentComments\";\nimport PopupWithFunction from \"../../../parts/PopupWithFunction\";\nimport moment from 'moment'\nclass EmploeeAssignments extends Component {\n  constructor() {\n    super();\n    this.state = {};\n  }\n\n  async componentDidMount() {\n    \n    this.getAssignments();\n  }\n\n  getAssignments = async () => {\n    const api = \"assignment\";\n    const res = await apiGetRequest(api);\n    if (res.ok) {\n      this.setState({\n        assignments_list: res.result,\n        assignments_loaded: true,\n      });\n    }\n  };\n\n \n  handleAssignment = (action, new_assignment, assignment_to_edit) => {\n    this.setState({\n      handle_assignment: action,\n      new_assignment,\n      assignment_to_edit,\n    });\n  };\n\n  createAndUpdateAssignment = async (assignment) => {\n    const { employee, manager_assignments } = this.props;\n    const api = `employee_assignment`;\n    assignment[\"employee_id\"] = employee._id;\n    assignment[\"status\"] = assignment.status ? assignment.status : \"pending\";\n    assignment[\"deadline\"] = assignment.deadline ? assignment.deadline : moment().toDate()\n    console.log(assignment);\n    const res = await apiPostRequest(api, assignment);\n    if (res.ok) {\n      let index = employee.assignments.findIndex(\n        (m) => m._id == assignment._id\n      );\n      let updated_employee = JSON.parse(JSON.stringify(employee))\n      if (index >= 0) {\n        updated_employee.assignments.splice(index, 1, res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment updated\");\n      } else {\n        updated_employee.assignments.unshift(res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment created\");\n      }\n      if(manager_assignments){\n        this.props.updateUserReducer('user', updated_employee)\n      }else{\n        this.props.updateParentState('employee',updated_employee);\n      }\n     \n      const url = window.location.pathname\n      if(url.indexOf('assignment') > -1){\n        this.updateAssignmentInAssignmentPage(res.result)\n    }\n    }\n  };\n\n  handleDelete = (assignment_to_remove) => {\n    console.log(assignment_to_remove);\n    this.setState({\n      assignment_to_remove,\n    });\n  };\n  handleAssignmentComments = (assignment_comments) => {\n    this.setState({\n      assignment_comments,\n    });\n  };\n\n  remove = async () => {\n    const { assignment_to_remove, manager_assignments } = this.state;\n    const { employee } = this.props;\n    this.setState({\n      delete_loading:true\n    })\n    assignment_to_remove[\"employee_id\"] = employee._id;\n    const api = \"employee_assignment/delete\";\n    const res = await apiPostRequest(api, assignment_to_remove);\n    if (res.ok) {\n      let updated = { ...employee };\n      let index = updated.assignments.findIndex(\n        (m) => m._id == assignment_to_remove._id\n      );\n      if (index >= 0) {\n        updated.assignments.splice(index, 1);\n        if(manager_assignments){\n          this.props.updateUserReducer('user', updated)\n        }else{\n          this.props.updateEmployee(updated);\n        }\n        \n        this.close();\n      }\n      const url = window.location.pathname\n      if(url.indexOf('assignment') === 0){\n          this.props.history.push(EMPLOYEE_ROUTE.replace(':id', employee._id))\n      }\n    }\n  setTimeout(() => {\n    this.setState({\n      delete_loading:false\n    })\n  }, 300);\n  };\n\n  close = () => {\n    this.handleDelete();\n  };\n\n\nupdateAssignmentInAssignmentPage = (page_assignment) => {\n    this.setState({\n        page_assignment\n    })\n}\nupdateState = (name, value) => {\n    this.setState({\n        [name]:value\n    })\n}\n\n  render() {\n    const {\n      assignments_list,\n      assignments_loaded,\n      assignment_comments,\n      handle_assignment,\n      new_assignment,\n      assignment_to_edit,\n      assignment_to_remove,\n      page_assignment,\n      delete_loading\n    } = this.state;\n    const {system_text} = this.props.global\n    const { active_section, employee, hide_page, manager_assignments } = this.props;\n    \n    const {user} = this.props.user\n    \n    return (\n      <div   \n      style ={{\n        opacity:hide_page ? 0 : 1,\n        transition:'0.2s all'\n      }}>\n      <PopupWithFunction\n          text={system_text.REMOVE_ASSIGNMENT_QUESTION}\n          name={`${assignment_to_remove ? assignment_to_remove.title : \"\"}?`}\n          active={assignment_to_remove}\n          submit={this.remove}\n          close={this.close}\n          submit_text={system_text.YES}\n          close_text={system_text.NO}\n          loading = {delete_loading}\n        />\n        {assignment_comments ? (\n          <AssignmentComments\n            updateAssignment={this.createAndUpdateAssignment}\n            assignment={assignment_comments}\n            updateParentState={this.updateState}\n            system_text = {system_text}\n          />\n        ) : (\n          \"\"\n        )}\n        {handle_assignment ? (\n          <HandleAssignment\n            new_assignment={new_assignment}\n            edit={this.createAndUpdateAssignment}\n            create={this.createAndUpdateAssignment}\n            assignment_to_edit={assignment_to_edit}\n            toggleHandleAssignment={this.handleAssignment}\n            from_employee_page={true}\n            handleDelete = {this.handleDelete}\n            assignments_list = {assignments_list}\n           \n          />\n        ) : null}\n\n        {\n          manager_assignments ? \n\n          <Switch>\n          <Route\n            exact\n            path={PERSONAL_ASSIGNMENTS_ROUTE}\n            render={() => (\n              <EmployeeTodoList\n              manager_assignments = {manager_assignments}\n                handleAssignmentComments={this.handleAssignmentComments}\n                handleAssignment={this.handleAssignment}\n                updateEmployee={this.updateEmployee}\n                employee={employee ? employee : {}}\n                assignments_loaded={assignments_loaded}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleDelete = {this.handleDelete}\n              />\n            )}\n          />\n          <Route\n           exact\n            path={PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT}\n            render={() => (\n              <EmployeeAssignmentPage\n                employee={employee}\n                manager_assignments = {manager_assignments}\n                active_section={active_section}\n                handleAssignment={this.handleAssignment}\n                handleDelete = {this.handleDelete}\n                assignment = {page_assignment}\n                updateAssignmentInAssignmentPage = {this.updateAssignmentInAssignmentPage}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleAssignmentComments = {this.handleAssignmentComments}\n              />\n            )}\n          />\n        </Switch> :\n          <Switch>\n          <Route\n            exact\n            path={user.is_manager ? EMPLOYEE_ROUTE   : EMPLOYEE_DASHBOARD_PAGE_ROUTE}\n            render={() => (\n              <EmployeeTodoList\n                handleAssignmentComments={this.handleAssignmentComments}\n                handleAssignment={this.handleAssignment}\n                updateEmployee={this.updateEmployee}\n                employee={employee ? employee : {}}\n                assignments_loaded={assignments_loaded}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleDelete = {this.handleDelete}\n              />\n            )}\n          />\n          <Route\n           exact\n            path={user.is_manager ? EMPLOYEE_ASSIGNMENT_ROUTE : EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE}\n            render={() => (\n              <EmployeeAssignmentPage\n                employee={employee}\n                active_section={active_section}\n                handleAssignment={this.handleAssignment}\n                handleDelete = {this.handleDelete}\n                assignment = {page_assignment}\n                updateAssignmentInAssignmentPage = {this.updateAssignmentInAssignmentPage}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleAssignmentComments = {this.handleAssignmentComments}\n              />\n            )}\n          />\n        </Switch>}\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ employees, navbar, assignments, user, global }) {\n  return { employees, navbar, assignments, user , global};\n}\n\nexport default withRouter(\n  connect(mapStateToProps, actions)(EmploeeAssignments)\n);\n"]},"metadata":{},"sourceType":"module"}