{"ast":null,"code":"import _defineProperty from \"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/denis/Desktop/projects/todo/front/client/src/components/login/parts/SignInForm.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from \"react\";\nimport signin_inputs from \"./signin-inputs\";\nimport TextInput from \"../../../parts/inputs/TextInput\";\nimport { apiPostRequest } from \"../../../tools/api\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { DASHBOARD_ROUTE, EMPLOYEES_ROUTE, EMPLOYEE_DASHBOARD_ROUTE } from \"../../../tools/routes\";\nimport { setCookie, removeCookie } from \"../../../tools/cookie\";\nimport { AUTH_TOKEN } from \"../../../tools/keys\";\nimport { withRouter } from \"react-router\";\nimport SumbitBtn from \"../../../parts/SumbitBtn\";\n\nclass SignInForm extends Component {\n  constructor() {\n    super();\n\n    this.updateForm = (name, value) => {\n      const form_data = _objectSpread({}, this.state.form_data);\n\n      form_data[name] = value;\n      this.setState({\n        form_data\n      });\n    };\n\n    this.submitForm = e => {\n      e.preventDefault();\n      this.setState({\n        validate: true\n      });\n      setTimeout(() => {\n        const errors = document.querySelectorAll(\".text__input__error\");\n\n        if (errors.length === 0) {\n          this.signin();\n        }\n\n        this.setState({\n          validate: false\n        });\n      }, 50);\n    };\n\n    this.signin = async () => {\n      const form_data = this.state.form_data;\n      this.setState({\n        loading: true\n      });\n      const api = \"auth/login\";\n      const res = await apiPostRequest(api, form_data);\n\n      if (res.ok) {\n        this.props.updateUserReducer(\"user\", res.result);\n        setCookie(AUTH_TOKEN, res.result.token);\n        if (res.result.is_manager) return this.props.history.push(EMPLOYEES_ROUTE);\n\n        if (!res.result.active) {\n          removeCookie(AUTH_TOKEN);\n          this.setState({\n            loading: false\n          });\n          return this.props.updateGlobalReducer('error', 'Employee is inactive');\n        } else return this.props.history.push(EMPLOYEE_DASHBOARD_ROUTE.replace(\":id\", res.result._id));\n      }\n\n      if (!res.ok && res.result) {\n        this.props.updateGlobalReducer('error', res.result);\n      }\n\n      this.setState({\n        loading: false\n      });\n    };\n\n    this.state = {\n      form_data: {}\n    };\n  }\n\n  render() {\n    const _this$state = this.state,\n          form_data = _this$state.form_data,\n          validate = _this$state.validate,\n          loading = _this$state.loading;\n    return React.createElement(\"div\", {\n      className: \"login flex__center\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, React.createElement(\"form\", {\n      onSubmit: e => this.submitForm(e),\n      className: \"login__form signin__form flex__column\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, \"Login\"), React.createElement(\"section\", {\n      className: \"login__form__inputs\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, signin_inputs.map((input, i) => {\n      return React.createElement(TextInput, {\n        key: i,\n        handleUpdate: this.updateForm,\n        input: input,\n        validate: validate,\n        value: form_data[input.property_name],\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86\n        },\n        __self: this\n      });\n    })), React.createElement(SumbitBtn, {\n      text: \"Submit\",\n      active: loading,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96\n      },\n      __self: this\n    })));\n  }\n\n}\n\nfunction mapStateToProps({\n  user\n}) {\n  return {\n    user\n  };\n}\n\nexport default withRouter(connect(mapStateToProps, actions)(SignInForm));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/components/login/parts/SignInForm.jsx"],"names":["React","Component","signin_inputs","TextInput","apiPostRequest","connect","actions","DASHBOARD_ROUTE","EMPLOYEES_ROUTE","EMPLOYEE_DASHBOARD_ROUTE","setCookie","removeCookie","AUTH_TOKEN","withRouter","SumbitBtn","SignInForm","constructor","updateForm","name","value","form_data","state","setState","submitForm","e","preventDefault","validate","setTimeout","errors","document","querySelectorAll","length","signin","loading","api","res","ok","props","updateUserReducer","result","token","is_manager","history","push","active","updateGlobalReducer","replace","_id","render","map","input","i","property_name","mapStateToProps","user"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport signin_inputs from \"./signin-inputs\";\nimport TextInput from \"../../../parts/inputs/TextInput\";\nimport { apiPostRequest } from \"../../../tools/api\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { DASHBOARD_ROUTE, EMPLOYEES_ROUTE, EMPLOYEE_DASHBOARD_ROUTE } from \"../../../tools/routes\";\nimport { setCookie, removeCookie } from \"../../../tools/cookie\";\nimport { AUTH_TOKEN } from \"../../../tools/keys\";\nimport { withRouter } from \"react-router\";\nimport SumbitBtn from \"../../../parts/SumbitBtn\";\n\nclass SignInForm extends Component {\n  constructor() {\n    super();\n    this.state = {\n      form_data: {},\n    };\n  }\n\n  updateForm = (name, value) => {\n    const form_data = { ...this.state.form_data };\n    form_data[name] = value;\n    this.setState({\n      form_data,\n    });\n  };\n  submitForm = (e) => {\n    e.preventDefault();\n    this.setState({\n      validate: true,\n    });\n    setTimeout(() => {\n      const errors = document.querySelectorAll(\".text__input__error\");\n      if (errors.length === 0) {\n        this.signin();\n      } \n      this.setState({\n        validate: false,\n      });\n    }, 50);\n  };\n\n  signin = async () => {\n    const { form_data } = this.state;\n    this.setState({\n      loading:true\n    })\n    const api = \"auth/login\";\n    const res = await apiPostRequest(api, form_data);\n    if (res.ok) {\n      this.props.updateUserReducer(\"user\", res.result);\n      setCookie(AUTH_TOKEN, res.result.token);\n      if(res.result.is_manager)  return this.props.history.push(EMPLOYEES_ROUTE);\n      if(!res.result.active) {\n        removeCookie(AUTH_TOKEN);\n        this.setState({\n          loading:false\n        })\n        return  this.props.updateGlobalReducer('error','Employee is inactive');\n      }\n     else return this.props.history.push(\n      EMPLOYEE_DASHBOARD_ROUTE.replace(\":id\", res.result._id)\n    )\n    }\n    if (!res.ok && res.result) {\n      this.props.updateGlobalReducer('error',res.result);\n    }\n    this.setState({\n      loading:false\n    })\n  };\n\n  render() {\n    const { form_data, validate, loading } = this.state;\n    return (\n      <div className='login flex__center'>\n       <form\n        onSubmit={(e) => this.submitForm(e)}\n        className=\"login__form signin__form flex__column\"\n      >\n        <h2>Login</h2>\n        <section className=\"login__form__inputs\">\n          {signin_inputs.map((input, i) => {\n            return (\n              <TextInput\n                key={i}\n                handleUpdate={this.updateForm}\n                input={input}\n                validate={validate}\n                value={form_data[input.property_name]}\n              />\n            );\n          })}\n        </section>\n       <SumbitBtn\n       text = 'Submit'\n       active = {loading}\n       />\n      </form> \n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ user }) {\n  return { user };\n}\n\nexport default withRouter(connect(mapStateToProps, actions)(SignInForm));\n"]},"metadata":{},"sourceType":"module"}