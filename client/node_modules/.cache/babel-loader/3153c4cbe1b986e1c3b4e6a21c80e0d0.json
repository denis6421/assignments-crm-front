{"ast":null,"code":"import _defineProperty from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{Component}from\"react\";import{connect}from\"react-redux\";import*as actions from\"../../../actions/actions\";import{apiGetRequest,apiPostRequest}from\"../../../tools/api\";import EmployeeTodoList from\"./EmployeeTodoList\";import{withRouter}from\"react-router\";import{BrowserRouter as Router,Route,Switch}from\"react-router-dom\";import{EMPLOYEE_ROUTE,EMPLOYEE_ASSIGNMENT_ROUTE,EMPLOYEE_DASHBOARD_PAGE_ROUTE,EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,PERSONAL_ASSIGNMENTS_ROUTE,PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT}from\"../../../tools/routes\";import EmployeeAssignmentPage from\"../employee-assignment-page/EmployeeAssignmentPage\";import HandleAssignment from\"../../assignments/parts/HandleAssignment\";import AssignmentComments from\"../parts/AssignmentComments\";import PopupWithFunction from\"../../../parts/PopupWithFunction\";import moment from'moment';var EmploeeAssignments=/*#__PURE__*/function(_Component){_inherits(EmploeeAssignments,_Component);function EmploeeAssignments(){var _this;_classCallCheck(this,EmploeeAssignments);_this=_possibleConstructorReturn(this,_getPrototypeOf(EmploeeAssignments).call(this));_this.getAssignments=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var api,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:api=\"assignment\";_context.next=3;return apiGetRequest(api);case 3:res=_context.sent;if(res.ok){_this.setState({assignments_list:res.result,assignments_loaded:true});}case 5:case\"end\":return _context.stop();}}},_callee);}));_this.handleAssignment=function(action,new_assignment,assignment_to_edit){_this.setState({handle_assignment:action,new_assignment:new_assignment,assignment_to_edit:assignment_to_edit});};_this.createAndUpdateAssignment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(assignment){var _this$props,employee,manager_assignments,api,res,index,updated_employee,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this$props=_this.props,employee=_this$props.employee,manager_assignments=_this$props.manager_assignments;api=\"employee_assignment\";assignment[\"employee_id\"]=employee._id;assignment[\"status\"]=assignment.status?assignment.status:\"pending\";assignment[\"deadline\"]=assignment.deadline?assignment.deadline:moment().toDate();console.log(assignment);_context2.next=8;return apiPostRequest(api,assignment);case 8:res=_context2.sent;if(res.ok){index=employee.assignments.findIndex(function(m){return m._id==assignment._id;});updated_employee=JSON.parse(JSON.stringify(employee));if(index>=0){updated_employee.assignments.splice(index,1,res.result);_this.props.updateGlobalReducer(\"success\",\"Assignment updated\");}else{updated_employee.assignments.unshift(res.result);_this.props.updateGlobalReducer(\"success\",\"Assignment created\");}if(manager_assignments){_this.props.updateUserReducer('user',updated_employee);}else{_this.props.updateParentState('employee',updated_employee);}url=window.location.pathname;if(url.indexOf('assignment')>-1){_this.updateAssignmentInAssignmentPage(res.result);}}case 10:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handleDelete=function(assignment_to_remove){console.log(assignment_to_remove);_this.setState({assignment_to_remove:assignment_to_remove});};_this.handleAssignmentComments=function(assignment_comments){_this.setState({assignment_comments:assignment_comments});};_this.remove=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var assignment_to_remove,employee,api,res,updated,index,url;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:assignment_to_remove=_this.state.assignment_to_remove;employee=_this.props.employee;_this.setState({delete_loading:true});assignment_to_remove[\"employee_id\"]=employee._id;api=\"employee_assignment/delete\";_context3.next=7;return apiPostRequest(api,assignment_to_remove);case 7:res=_context3.sent;if(res.ok){updated=_objectSpread({},employee);index=updated.assignments.findIndex(function(m){return m._id==assignment_to_remove._id;});if(index>=0){updated.assignments.splice(index,1);_this.props.updateEmployee(updated);_this.close();}url=window.location.pathname;if(url.indexOf('assignment')===0){_this.props.history.push(EMPLOYEE_ROUTE.replace(':id',employee._id));}}setTimeout(function(){_this.setState({delete_loading:false});},300);case 10:case\"end\":return _context3.stop();}}},_callee3);}));_this.close=function(){_this.handleDelete();};_this.updateAssignmentInAssignmentPage=function(page_assignment){_this.setState({page_assignment:page_assignment});};_this.updateState=function(name,value){_this.setState(_defineProperty({},name,value));};_this.state={};return _this;}_createClass(EmploeeAssignments,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.getAssignments();case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,assignments_list=_this$state.assignments_list,assignments_loaded=_this$state.assignments_loaded,assignment_comments=_this$state.assignment_comments,handle_assignment=_this$state.handle_assignment,new_assignment=_this$state.new_assignment,assignment_to_edit=_this$state.assignment_to_edit,assignment_to_remove=_this$state.assignment_to_remove,page_assignment=_this$state.page_assignment,delete_loading=_this$state.delete_loading;var system_text=this.props.global.system_text;var _this$props2=this.props,active_section=_this$props2.active_section,employee=_this$props2.employee,hide_page=_this$props2.hide_page,manager_assignments=_this$props2.manager_assignments;var user=this.props.user.user;return React.createElement(\"div\",{style:{opacity:hide_page?0:1,transition:'0.2s all'}},React.createElement(PopupWithFunction,{text:system_text.REMOVE_ASSIGNMENT_QUESTION,name:\"\".concat(assignment_to_remove?assignment_to_remove.title:\"\",\"?\"),active:assignment_to_remove,submit:this.remove,close:this.close,submit_text:system_text.YES,close_text:system_text.NO,loading:delete_loading}),assignment_comments?React.createElement(AssignmentComments,{updateAssignment:this.createAndUpdateAssignment,assignment:assignment_comments,updateParentState:this.updateState,system_text:system_text}):\"\",handle_assignment?React.createElement(HandleAssignment,{new_assignment:new_assignment,edit:this.createAndUpdateAssignment,create:this.createAndUpdateAssignment,assignment_to_edit:assignment_to_edit,toggleHandleAssignment:this.handleAssignment,from_employee_page:true,handleDelete:this.handleDelete,assignments_list:assignments_list}):null,manager_assignments?React.createElement(Switch,null,React.createElement(Route,{exact:true,path:PERSONAL_ASSIGNMENTS_ROUTE,render:function render(){return React.createElement(EmployeeTodoList,{manager_assignments:manager_assignments,handleAssignmentComments:_this2.handleAssignmentComments,handleAssignment:_this2.handleAssignment,updateEmployee:_this2.updateEmployee,employee:employee?employee:{},assignments_loaded:assignments_loaded,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleDelete:_this2.handleDelete});}}),React.createElement(Route,{exact:true,path:PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT,render:function render(){return React.createElement(EmployeeAssignmentPage,{employee:employee,manager_assignments:manager_assignments,active_section:active_section,handleAssignment:_this2.handleAssignment,handleDelete:_this2.handleDelete,assignment:page_assignment,updateAssignmentInAssignmentPage:_this2.updateAssignmentInAssignmentPage,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleAssignmentComments:_this2.handleAssignmentComments});}})):React.createElement(Switch,null,React.createElement(Route,{exact:true,path:user.is_manager?EMPLOYEE_ROUTE:EMPLOYEE_DASHBOARD_PAGE_ROUTE,render:function render(){return React.createElement(EmployeeTodoList,{handleAssignmentComments:_this2.handleAssignmentComments,handleAssignment:_this2.handleAssignment,updateEmployee:_this2.updateEmployee,employee:employee?employee:{},assignments_loaded:assignments_loaded,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleDelete:_this2.handleDelete});}}),React.createElement(Route,{exact:true,path:user.is_manager?EMPLOYEE_ASSIGNMENT_ROUTE:EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,render:function render(){return React.createElement(EmployeeAssignmentPage,{employee:employee,active_section:active_section,handleAssignment:_this2.handleAssignment,handleDelete:_this2.handleDelete,assignment:page_assignment,updateAssignmentInAssignmentPage:_this2.updateAssignmentInAssignmentPage,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleAssignmentComments:_this2.handleAssignmentComments});}})));}}]);return EmploeeAssignments;}(Component);function mapStateToProps(_ref4){var employees=_ref4.employees,navbar=_ref4.navbar,assignments=_ref4.assignments,user=_ref4.user,global=_ref4.global;return{employees:employees,navbar:navbar,assignments:assignments,user:user,global:global};}export default withRouter(connect(mapStateToProps,actions)(EmploeeAssignments));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/components/employee-page/employee-assignments/EmploeeAssignments.jsx"],"names":["React","Component","connect","actions","apiGetRequest","apiPostRequest","EmployeeTodoList","withRouter","BrowserRouter","Router","Route","Switch","EMPLOYEE_ROUTE","EMPLOYEE_ASSIGNMENT_ROUTE","EMPLOYEE_DASHBOARD_PAGE_ROUTE","EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE","PERSONAL_ASSIGNMENTS_ROUTE","PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT","EmployeeAssignmentPage","HandleAssignment","AssignmentComments","PopupWithFunction","moment","EmploeeAssignments","getAssignments","api","res","ok","setState","assignments_list","result","assignments_loaded","handleAssignment","action","new_assignment","assignment_to_edit","handle_assignment","createAndUpdateAssignment","assignment","props","employee","manager_assignments","_id","status","deadline","toDate","console","log","index","assignments","findIndex","m","updated_employee","JSON","parse","stringify","splice","updateGlobalReducer","unshift","updateUserReducer","updateParentState","url","window","location","pathname","indexOf","updateAssignmentInAssignmentPage","handleDelete","assignment_to_remove","handleAssignmentComments","assignment_comments","remove","state","delete_loading","updated","updateEmployee","close","history","push","replace","setTimeout","page_assignment","updateState","name","value","system_text","global","active_section","hide_page","user","opacity","transition","REMOVE_ASSIGNMENT_QUESTION","title","YES","NO","is_manager","mapStateToProps","employees","navbar"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { apiGetRequest, apiPostRequest } from \"../../../tools/api\";\nimport EmployeeTodoList from \"./EmployeeTodoList\";\nimport { withRouter } from \"react-router\";\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport {\n  EMPLOYEE_ROUTE,\n  EMPLOYEE_ASSIGNMENT_ROUTE,\n  EMPLOYEE_DASHBOARD_PAGE_ROUTE,\n  EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,\n  PERSONAL_ASSIGNMENTS_ROUTE,\n  PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT\n} from \"../../../tools/routes\";\nimport EmployeeAssignmentPage from \"../employee-assignment-page/EmployeeAssignmentPage\";\nimport HandleAssignment from \"../../assignments/parts/HandleAssignment\";\nimport AssignmentComments from \"../parts/AssignmentComments\";\nimport PopupWithFunction from \"../../../parts/PopupWithFunction\";\nimport moment from 'moment'\nclass EmploeeAssignments extends Component {\n  constructor() {\n    super();\n    this.state = {};\n  }\n\n  async componentDidMount() {\n    \n    this.getAssignments();\n  }\n\n  getAssignments = async () => {\n    const api = \"assignment\";\n    const res = await apiGetRequest(api);\n    if (res.ok) {\n      this.setState({\n        assignments_list: res.result,\n        assignments_loaded: true,\n      });\n    }\n  };\n\n \n  handleAssignment = (action, new_assignment, assignment_to_edit) => {\n    this.setState({\n      handle_assignment: action,\n      new_assignment,\n      assignment_to_edit,\n    });\n  };\n\n  createAndUpdateAssignment = async (assignment) => {\n    const { employee, manager_assignments } = this.props;\n    const api = `employee_assignment`;\n    assignment[\"employee_id\"] = employee._id;\n    assignment[\"status\"] = assignment.status ? assignment.status : \"pending\";\n    assignment[\"deadline\"] = assignment.deadline ? assignment.deadline : moment().toDate()\n    console.log(assignment);\n    const res = await apiPostRequest(api, assignment);\n    if (res.ok) {\n      let index = employee.assignments.findIndex(\n        (m) => m._id == assignment._id\n      );\n      let updated_employee = JSON.parse(JSON.stringify(employee))\n      if (index >= 0) {\n        updated_employee.assignments.splice(index, 1, res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment updated\");\n      } else {\n        updated_employee.assignments.unshift(res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment created\");\n      }\n      if(manager_assignments){\n        this.props.updateUserReducer('user', updated_employee)\n      }else{\n        this.props.updateParentState('employee',updated_employee);\n      }\n     \n      const url = window.location.pathname\n      if(url.indexOf('assignment') > -1){\n        this.updateAssignmentInAssignmentPage(res.result)\n    }\n    }\n  };\n\n  handleDelete = (assignment_to_remove) => {\n    console.log(assignment_to_remove);\n    this.setState({\n      assignment_to_remove,\n    });\n  };\n  handleAssignmentComments = (assignment_comments) => {\n    this.setState({\n      assignment_comments,\n    });\n  };\n\n  remove = async () => {\n    const { assignment_to_remove } = this.state;\n    const { employee } = this.props;\n    this.setState({\n      delete_loading:true\n    })\n    assignment_to_remove[\"employee_id\"] = employee._id;\n    const api = \"employee_assignment/delete\";\n    const res = await apiPostRequest(api, assignment_to_remove);\n    if (res.ok) {\n      let updated = { ...employee };\n      let index = updated.assignments.findIndex(\n        (m) => m._id == assignment_to_remove._id\n      );\n      if (index >= 0) {\n        updated.assignments.splice(index, 1);\n        this.props.updateEmployee(updated);\n        this.close();\n      }\n      const url = window.location.pathname\n      if(url.indexOf('assignment') === 0){\n          this.props.history.push(EMPLOYEE_ROUTE.replace(':id', employee._id))\n      }\n    }\n  setTimeout(() => {\n    this.setState({\n      delete_loading:false\n    })\n  }, 300);\n  };\n\n  close = () => {\n    this.handleDelete();\n  };\n\n\nupdateAssignmentInAssignmentPage = (page_assignment) => {\n    this.setState({\n        page_assignment\n    })\n}\nupdateState = (name, value) => {\n    this.setState({\n        [name]:value\n    })\n}\n\n  render() {\n    const {\n      assignments_list,\n      assignments_loaded,\n      assignment_comments,\n      handle_assignment,\n      new_assignment,\n      assignment_to_edit,\n      assignment_to_remove,\n      page_assignment,\n      delete_loading\n    } = this.state;\n    const {system_text} = this.props.global\n    const { active_section, employee, hide_page, manager_assignments } = this.props;\n    \n    const {user} = this.props.user\n    \n    return (\n      <div   \n      style ={{\n        opacity:hide_page ? 0 : 1,\n        transition:'0.2s all'\n      }}>\n      <PopupWithFunction\n          text={system_text.REMOVE_ASSIGNMENT_QUESTION}\n          name={`${assignment_to_remove ? assignment_to_remove.title : \"\"}?`}\n          active={assignment_to_remove}\n          submit={this.remove}\n          close={this.close}\n          submit_text={system_text.YES}\n          close_text={system_text.NO}\n          loading = {delete_loading}\n        />\n        {assignment_comments ? (\n          <AssignmentComments\n            updateAssignment={this.createAndUpdateAssignment}\n            assignment={assignment_comments}\n            updateParentState={this.updateState}\n            system_text = {system_text}\n          />\n        ) : (\n          \"\"\n        )}\n        {handle_assignment ? (\n          <HandleAssignment\n            new_assignment={new_assignment}\n            edit={this.createAndUpdateAssignment}\n            create={this.createAndUpdateAssignment}\n            assignment_to_edit={assignment_to_edit}\n            toggleHandleAssignment={this.handleAssignment}\n            from_employee_page={true}\n            handleDelete = {this.handleDelete}\n            assignments_list = {assignments_list}\n           \n          />\n        ) : null}\n\n        {\n          manager_assignments ? \n\n          <Switch>\n          <Route\n            exact\n            path={PERSONAL_ASSIGNMENTS_ROUTE}\n            render={() => (\n              <EmployeeTodoList\n              manager_assignments = {manager_assignments}\n                handleAssignmentComments={this.handleAssignmentComments}\n                handleAssignment={this.handleAssignment}\n                updateEmployee={this.updateEmployee}\n                employee={employee ? employee : {}}\n                assignments_loaded={assignments_loaded}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleDelete = {this.handleDelete}\n              />\n            )}\n          />\n          <Route\n           exact\n            path={PERSONAL_ASSIGNMENTS_ROUTE_ASSIGNMENT}\n            render={() => (\n              <EmployeeAssignmentPage\n                employee={employee}\n                manager_assignments = {manager_assignments}\n                active_section={active_section}\n                handleAssignment={this.handleAssignment}\n                handleDelete = {this.handleDelete}\n                assignment = {page_assignment}\n                updateAssignmentInAssignmentPage = {this.updateAssignmentInAssignmentPage}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleAssignmentComments = {this.handleAssignmentComments}\n              />\n            )}\n          />\n        </Switch> :\n          <Switch>\n          <Route\n            exact\n            path={user.is_manager ? EMPLOYEE_ROUTE   : EMPLOYEE_DASHBOARD_PAGE_ROUTE}\n            render={() => (\n              <EmployeeTodoList\n                handleAssignmentComments={this.handleAssignmentComments}\n                handleAssignment={this.handleAssignment}\n                updateEmployee={this.updateEmployee}\n                employee={employee ? employee : {}}\n                assignments_loaded={assignments_loaded}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleDelete = {this.handleDelete}\n              />\n            )}\n          />\n          <Route\n           exact\n            path={user.is_manager ? EMPLOYEE_ASSIGNMENT_ROUTE : EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE}\n            render={() => (\n              <EmployeeAssignmentPage\n                employee={employee}\n                active_section={active_section}\n                handleAssignment={this.handleAssignment}\n                handleDelete = {this.handleDelete}\n                assignment = {page_assignment}\n                updateAssignmentInAssignmentPage = {this.updateAssignmentInAssignmentPage}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleAssignmentComments = {this.handleAssignmentComments}\n              />\n            )}\n          />\n        </Switch>}\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ employees, navbar, assignments, user, global }) {\n  return { employees, navbar, assignments, user , global};\n}\n\nexport default withRouter(\n  connect(mapStateToProps, actions)(EmploeeAssignments)\n);\n"]},"metadata":{},"sourceType":"module"}