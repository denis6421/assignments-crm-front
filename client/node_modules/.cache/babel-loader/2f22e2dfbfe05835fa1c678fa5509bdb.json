{"ast":null,"code":"import _toConsumableArray from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{withRouter}from\"react-router-dom\";import{connect}from\"react-redux\";import*as actions from\"../../actions/actions\";import Employee from\"./parts/Employee\";import HandleProfile from\"./parts/HandleProfile\";import PopupWithFunction from\"../../parts/PopupWithFunction\";import{apiGetRequest,apiPostRequest}from\"../../tools/api\";import EmployeeLoader from\"./parts/EmployeeLoader\";import NoData from\"../../parts/NoData\";import PersonAddIcon from'@material-ui/icons/PersonAdd';import BtnWithTooltip from\"../../parts/BtnWithTooltip\";var Employees=/*#__PURE__*/function(_Component){_inherits(Employees,_Component);function Employees(){var _this;_classCallCheck(this,Employees);_this=_possibleConstructorReturn(this,_getPrototypeOf(Employees).call(this));_this.updateState=function(name,value){_this.setState(_defineProperty({},name,value));};_this.toggleHandleEmployee=function(status,employee){_this.setState({handle_employee:status,employee:employee});};_this.handleRemove=function(employee){_this.setState({employee_to_remove:employee});};_this.remove=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _this$state,employee_to_remove,employees_list,api,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this$state=_this.state,employee_to_remove=_this$state.employee_to_remove,employees_list=_this$state.employees_list;_this.setState({remove_loading:true});api=\"employee/delete\";_context.next=5;return apiPostRequest(api,{id:employee_to_remove._id});case 5:res=_context.sent;if(res.ok){_this.props.removeEmployee(employee_to_remove,employees_list);_this.setState({employees_list:employees_list.filter(function(m){return m._id!==employee_to_remove._id;})});_this.close();}setTimeout(function(){_this.setState({remove_loading:false});},400);case 8:case\"end\":return _context.stop();}}},_callee);}));_this.close=function(){_this.setState({employee_to_remove:\"\"});};_this.handleView=function(view){_this.setState({list_view:view});};_this.saveEmployee=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(profile,pw_changed){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!pw_changed){_context2.next=3;break;}_context2.next=3;return _this.resetEmployeePassword(profile);case 3:if(profile._id)_this.updateEmployee(profile);else _this.createEmployee(profile);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}();_this.createEmployee=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(profile){var api,res,employees_list;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:api=\"employee/create\";_context3.next=3;return apiPostRequest(api,profile);case 3:res=_context3.sent;if(res.ok){_this.props.updateGlobalReducer(\"success\",\"Employee created successfully\");employees_list=JSON.parse(JSON.stringify(_this.state.employees_list));_this.setState({employees_list:[res.result].concat(_toConsumableArray(employees_list))});}else{_this.props.updateGlobalReducer(\"error\",res.result?res.result:\"Failed to create employee\");}case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x3){return _ref3.apply(this,arguments);};}();_this.updateEmployee=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(profile){var api,res,employees_list,index;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:api=\"employee/update\";_context4.next=3;return apiPostRequest(api,profile);case 3:res=_context4.sent;if(res.ok){_this.props.updateGlobalReducer(\"success\",\"Employee updated successfully\");employees_list=JSON.parse(JSON.stringify(_this.state.employees_list));index=employees_list.findIndex(function(m){return m._id==profile._id;});if(index>=0){employees_list.splice(index,1,res.result);_this.setState({employees_list:employees_list});}}else{_this.props.updateGlobalReducer(\"error\",\"Failed to update employee\");}case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x4){return _ref4.apply(this,arguments);};}();_this.resetEmployeePassword=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(profile){var api,body;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:api=\"employee/password-reset\";body={_id:profile._id,password:profile.password};_context5.next=4;return apiPostRequest(api,body);case 4:case\"end\":return _context5.stop();}}},_callee5);}));return function(_x5){return _ref5.apply(this,arguments);};}();_this.state={list_view:\"row\"};return _this;}_createClass(Employees,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var _this2=this;var api,res;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:api=\"employee/all\";setTimeout(function(){_this2.setState({page_loaded:true});},20);_context6.next=4;return apiGetRequest(api);case 4:res=_context6.sent;if(res.ok){this.setState({loaded:true,employees_list:res.result});}case 6:case\"end\":return _context6.stop();}}},_callee6,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this3=this;var _this$state2=this.state,employees_list=_this$state2.employees_list,employee=_this$state2.employee,handle_employee=_this$state2.handle_employee,employee_to_remove=_this$state2.employee_to_remove,list_view=_this$state2.list_view,loaded=_this$state2.loaded,page_loaded=_this$state2.page_loaded,remove_loading=_this$state2.remove_loading;var system_text=this.props.global.system_text;return React.createElement(\"div\",{style:{opacity:page_loaded?1:0},className:\"employees\"},React.createElement(PopupWithFunction,{text:system_text.REMOVE_TEXT,name:\"\".concat(employee_to_remove?employee_to_remove.name:\"\",\"?\"),active:employee_to_remove,submit:this.remove,close:this.close,submit_text:system_text.YES,close_text:system_text.NO,loading:remove_loading}),handle_employee?React.createElement(HandleProfile,{toggleHandleProfile:this.toggleHandleEmployee,profile_to_edit:employee,save:this.saveEmployee,resetPassword:this.resetEmployeePassword,edit_text:system_text.EDIT_EMPLOYEE,create_text:system_text.CREATE_EMPLOYEE}):\"\",React.createElement(\"div\",{className:\"page__flex\"},React.createElement(\"header\",{className:\"flex__start employees__header\"},React.createElement(BtnWithTooltip,{svg:React.createElement(PersonAddIcon,null),handleClick:this.toggleHandleEmployee,value:true,tooltip:system_text.CREATE})),loaded&&employees_list&&employees_list.length>0?React.createElement(React.Fragment,null,React.createElement(\"section\",{className:\"titles__section flex__start\"},system_text.EMPLOYEES_TITLES.map(function(m,i){return React.createElement(\"h3\",{key:i},m);})),React.createElement(\"ul\",{className:\"employees__list flex__start\"},employees_list.map(function(m){return React.createElement(Employee,{list_view:list_view,toggleHandleEmployee:_this3.toggleHandleEmployee,employee:m,key:m._id,handleRemove:_this3.handleRemove});}))):!loaded?React.createElement(EmployeeLoader,{arr:_toConsumableArray(Array(5).keys())}):React.createElement(NoData,{text:system_text.NO_EMPLOYEES})));}}]);return Employees;}(Component);function mapStateToProps(_ref6){var employees=_ref6.employees,user=_ref6.user,global=_ref6.global;return{employees:employees,user:user,global:global};}export default withRouter(connect(mapStateToProps,actions)(Employees));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/components/employees/Employees.jsx"],"names":["React","Component","withRouter","connect","actions","Employee","HandleProfile","PopupWithFunction","apiGetRequest","apiPostRequest","EmployeeLoader","NoData","PersonAddIcon","BtnWithTooltip","Employees","updateState","name","value","setState","toggleHandleEmployee","status","employee","handle_employee","handleRemove","employee_to_remove","remove","state","employees_list","remove_loading","api","id","_id","res","ok","props","removeEmployee","filter","m","close","setTimeout","handleView","view","list_view","saveEmployee","profile","pw_changed","resetEmployeePassword","updateEmployee","createEmployee","updateGlobalReducer","JSON","parse","stringify","result","index","findIndex","splice","body","password","page_loaded","loaded","system_text","global","opacity","REMOVE_TEXT","YES","NO","EDIT_EMPLOYEE","CREATE_EMPLOYEE","CREATE","length","EMPLOYEES_TITLES","map","i","Array","keys","NO_EMPLOYEES","mapStateToProps","employees","user"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../actions/actions\";\nimport Employee from \"./parts/Employee\";\nimport HandleProfile from \"./parts/HandleProfile\";\nimport PopupWithFunction from \"../../parts/PopupWithFunction\";\nimport { apiGetRequest, apiPostRequest } from \"../../tools/api\";\nimport EmployeeLoader from \"./parts/EmployeeLoader\";\nimport NoData from \"../../parts/NoData\";\nimport PersonAddIcon from '@material-ui/icons/PersonAdd';\nimport BtnWithTooltip from \"../../parts/BtnWithTooltip\";\n\n\n\nclass Employees extends Component {\n  constructor() {\n    super();\n    this.state = {\n      list_view: \"row\",\n    };\n  }\n\n  async componentDidMount() {\n    const api = \"employee/all\";\n   setTimeout(() => {\n    this.setState({\n      page_loaded:true,\n    })\n   }, 20);\n    const res = await apiGetRequest(api);\n    if (res.ok) {\n      this.setState({\n        loaded: true,\n        employees_list:res.result\n      });\n    }\n  }\n  updateState = (name, value) => {\n    this.setState({\n      [name]: value,\n    });\n  };\n\n  toggleHandleEmployee = (status, employee) => {\n    this.setState({\n      handle_employee: status,\n      employee,\n    });\n  };\n\n  handleRemove = (employee) => {\n    this.setState({\n      employee_to_remove: employee,\n    });\n  };\n  remove = async () => {\n    const { employee_to_remove, employees_list } = this.state;\n    this.setState({\n      remove_loading:true\n    })\n    const api = \"employee/delete\";\n    const res = await apiPostRequest(api, { id: employee_to_remove._id });\n    if (res.ok) {\n      this.props.removeEmployee(employee_to_remove, employees_list);\n      this.setState({\n        employees_list:employees_list.filter(m => m._id !== employee_to_remove._id)\n      })\n      this.close();\n    }\n    setTimeout(() => {\n      this.setState({\n        remove_loading:false\n      })\n    }, 400);\n  };\n  close = () => {\n    this.setState({\n      employee_to_remove: \"\",\n    });\n  };\n\n  handleView = (view) => {\n    this.setState({\n      list_view: view,\n    });\n  };\n\n  saveEmployee = async (profile, pw_changed) => {  \n    if (pw_changed) await this.resetEmployeePassword(profile);\n    if (profile._id) this.updateEmployee(profile);\n    else this.createEmployee(profile);\n    };\n\n  createEmployee = async (profile) => {\n \n    const api = \"employee/create\";\n    const res = await apiPostRequest(api, profile);\n    if (res.ok) {\n      this.props.updateGlobalReducer(\n        \"success\",\n        \"Employee created successfully\"\n      );\n      let employees_list = JSON.parse(JSON.stringify(this.state.employees_list))\n      this.setState({\n        employees_list:[res.result, ...employees_list]\n      })\n    } else {\n      this.props.updateGlobalReducer(\"error\", res.result ? res.result : \"Failed to create employee\");\n    }\n  };\n\n  updateEmployee = async (profile) => {\n  \n    const api = \"employee/update\";\n    const res = await apiPostRequest(api, profile);\n    if (res.ok) {\n      this.props.updateGlobalReducer(\n        \"success\",\n        \"Employee updated successfully\"\n      );\n      let employees_list = JSON.parse(JSON.stringify(this.state.employees_list))\n      let index = employees_list.findIndex(m => m._id == profile._id)\n      if(index >= 0){\n        employees_list.splice(index,1 ,res.result)\n        this.setState({\n          employees_list\n        })\n      }\n    } else {\n      this.props.updateGlobalReducer(\"error\", \"Failed to update employee\");\n    }\n  };\n  resetEmployeePassword = async (profile) => {\n    const api = \"employee/password-reset\";\n    const body = {\n      _id: profile._id,\n      password: profile.password,\n    };\n    await apiPostRequest(api, body);\n  };\n\n  render() {\n   \n    const {\n      employees_list,\n      employee,\n      handle_employee,\n      employee_to_remove,\n      list_view,\n      loaded,\n      page_loaded,\n      remove_loading\n    } = this.state;\n    const {system_text} = this.props.global\n  \n\n    return (\n      <div \n      style ={{\n        opacity:page_loaded ? 1 : 0\n      }}\n      className=\"employees\">\n        <PopupWithFunction\n          text={system_text.REMOVE_TEXT}\n          name={`${employee_to_remove ? employee_to_remove.name : \"\"}?`}\n          active={employee_to_remove}\n          submit={this.remove}\n          close={this.close}\n          submit_text={system_text.YES}\n          close_text={system_text.NO}\n          loading = {remove_loading}\n        />\n        {handle_employee ? (\n          <HandleProfile\n            toggleHandleProfile={this.toggleHandleEmployee}\n            profile_to_edit={employee}\n            save={this.saveEmployee}\n            resetPassword={this.resetEmployeePassword}\n            edit_text={system_text.EDIT_EMPLOYEE}\n            create_text={system_text.CREATE_EMPLOYEE}\n          />\n        ) : (\n          \"\"\n        )}\n        <div className=\"page__flex\">\n          <header className=\"flex__start employees__header\">\n            <BtnWithTooltip\n                   svg = {<PersonAddIcon />}\n                   handleClick = {this.toggleHandleEmployee}\n                   value = {true}\n                   tooltip = {system_text.CREATE}\n                    />\n          </header>\n         {loaded && employees_list && employees_list.length > 0 ? <>\n         <section className='titles__section flex__start'>\n            {system_text.EMPLOYEES_TITLES.map((m, i) => {\n              return <h3 key = {i}>{m}</h3>\n            })}\n          </section>\n          <ul className=\"employees__list flex__start\">\n            {\n              employees_list.map((m) => {\n                return (\n                  <Employee\n                    list_view={list_view}\n                    toggleHandleEmployee={this.toggleHandleEmployee}\n                    employee={m}\n                    key={m._id}\n                    handleRemove={this.handleRemove}\n                  />\n                );\n              })\n            }\n          </ul>\n         </> : !loaded ? \n        <EmployeeLoader arr={[...Array(5).keys()]} /> : \n        <NoData text = {system_text.NO_EMPLOYEES}/>\n        }\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ employees, user, global }) {\n  return { employees, user, global };\n}\n\nexport default withRouter(connect(mapStateToProps, actions)(Employees));\n"]},"metadata":{},"sourceType":"module"}