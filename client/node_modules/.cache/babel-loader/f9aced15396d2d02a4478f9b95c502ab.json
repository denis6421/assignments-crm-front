{"ast":null,"code":"import _defineProperty from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{Component}from\"react\";import{connect}from\"react-redux\";import*as actions from\"../../../actions/actions\";import{apiGetRequest,apiPostRequest}from\"../../../tools/api\";import EmployeeTodoList from\"./EmployeeTodoList\";import{withRouter}from\"react-router\";import{BrowserRouter as Router,Route,Switch}from\"react-router-dom\";import{EMPLOYEE_ROUTE,EMPLOYEE_ASSIGNMENT_ROUTE,EMPLOYEE_DASHBOARD_PAGE_ROUTE,EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE}from\"../../../tools/routes\";import EmployeeAssignmentPage from\"../employee-assignment-page/EmployeeAssignmentPage\";import HandleAssignment from\"../../assignments/parts/HandleAssignment\";import AssignmentComments from\"../parts/AssignmentComments\";import PopupWithFunction from\"../../../parts/PopupWithFunction\";var EmploeeAssignments=/*#__PURE__*/function(_Component){_inherits(EmploeeAssignments,_Component);function EmploeeAssignments(){var _this;_classCallCheck(this,EmploeeAssignments);_this=_possibleConstructorReturn(this,_getPrototypeOf(EmploeeAssignments).call(this));_this.getAssignments=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var api,res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:api=\"assignment\";_context.next=3;return apiGetRequest(api);case 3:res=_context.sent;if(res.ok){_this.setState({assignments_list:res.result,assignments_loaded:true});}case 5:case\"end\":return _context.stop();}}},_callee);}));_this.handleAssignment=function(action,new_assignment,assignment_to_edit){_this.setState({handle_assignment:action,new_assignment:new_assignment,assignment_to_edit:assignment_to_edit});};_this.createAndUpdateAssignment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(assignment){var employee,api,res,index,updated_employee,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:employee=_this.props.employee;api=\"employee_assignment\";assignment[\"employee_id\"]=employee._id;assignment[\"status\"]=assignment.status?assignment.status:\"pending\";console.log(assignment);_context2.next=7;return apiPostRequest(api,assignment);case 7:res=_context2.sent;if(res.ok){index=employee.assignments.findIndex(function(m){return m._id==assignment._id;});updated_employee=JSON.parse(JSON.stringify(employee));if(index>=0){updated_employee.assignments.splice(index,1,res.result);_this.props.updateGlobalReducer(\"success\",\"Assignment updated\");}else{updated_employee.assignments.unshift(res.result);_this.props.updateGlobalReducer(\"success\",\"Assignment created\");}_this.props.updateParentState('employee',updated_employee);url=window.location.pathname;if(url.indexOf('assignment')>-1){_this.updateAssignmentInAssignmentPage(res.result);}}case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handleDelete=function(assignment_to_remove){console.log(assignment_to_remove);_this.setState({assignment_to_remove:assignment_to_remove});};_this.handleAssignmentComments=function(assignment_comments){_this.setState({assignment_comments:assignment_comments});};_this.remove=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var assignment_to_remove,employee,api,res,updated,index,url;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:assignment_to_remove=_this.state.assignment_to_remove;employee=_this.props.employee;_this.setState({delete_loading:true});assignment_to_remove[\"employee_id\"]=employee._id;api=\"employee_assignment/delete\";_context3.next=7;return apiPostRequest(api,assignment_to_remove);case 7:res=_context3.sent;if(res.ok){updated=_objectSpread({},employee);index=updated.assignments.findIndex(function(m){return m._id==assignment_to_remove._id;});if(index>=0){updated.assignments.splice(index,1);_this.props.updateEmployee(updated);_this.close();}url=window.location.pathname;if(url.indexOf('assignment')===0){_this.props.history.push(EMPLOYEE_ROUTE.replace(':id',employee._id));}}setTimeout(function(){_this.setState({delete_loading:false});},300);case 10:case\"end\":return _context3.stop();}}},_callee3);}));_this.close=function(){_this.handleDelete();};_this.updateAssignmentInAssignmentPage=function(page_assignment){_this.setState({page_assignment:page_assignment});};_this.updateState=function(name,value){_this.setState(_defineProperty({},name,value));};_this.state={};return _this;}_createClass(EmploeeAssignments,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:this.getAssignments();case 1:case\"end\":return _context4.stop();}}},_callee4,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this2=this;var _this$state=this.state,assignments_list=_this$state.assignments_list,assignments_loaded=_this$state.assignments_loaded,assignment_comments=_this$state.assignment_comments,handle_assignment=_this$state.handle_assignment,new_assignment=_this$state.new_assignment,assignment_to_edit=_this$state.assignment_to_edit,assignment_to_remove=_this$state.assignment_to_remove,page_assignment=_this$state.page_assignment,delete_loading=_this$state.delete_loading;var system_text=this.props.global.system_text;var _this$props=this.props,active_section=_this$props.active_section,employee=_this$props.employee,hide_page=_this$props.hide_page;var user=this.props.user.user;return React.createElement(\"div\",{style:{opacity:hide_page?0:1,transition:'0.2s all'}},React.createElement(PopupWithFunction,{text:system_text.REMOVE_ASSIGNMENT_QUESTION,name:\"\".concat(assignment_to_remove?assignment_to_remove.title:\"\",\"?\"),active:assignment_to_remove,submit:this.remove,close:this.close,submit_text:system_text.YES,close_text:system_text.NO,loading:delete_loading}),assignment_comments?React.createElement(AssignmentComments,{updateAssignment:this.createAndUpdateAssignment,assignment:assignment_comments,updateParentState:this.updateState,system_text:system_text}):\"\",handle_assignment?React.createElement(HandleAssignment,{new_assignment:new_assignment,edit:this.createAndUpdateAssignment,create:this.createAndUpdateAssignment,assignment_to_edit:assignment_to_edit,toggleHandleAssignment:this.handleAssignment,from_employee_page:true,handleDelete:this.handleDelete,assignments_list:assignments_list}):null,React.createElement(Switch,null,React.createElement(Route,{exact:true,path:user.is_manager?EMPLOYEE_ROUTE:EMPLOYEE_DASHBOARD_PAGE_ROUTE,render:function render(){return React.createElement(EmployeeTodoList,{handleAssignmentComments:_this2.handleAssignmentComments,handleAssignment:_this2.handleAssignment,updateEmployee:_this2.updateEmployee,employee:employee?employee:{},assignments_loaded:assignments_loaded,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleDelete:_this2.handleDelete});}}),React.createElement(Route,{exact:true,path:user.is_manager?EMPLOYEE_ASSIGNMENT_ROUTE:EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,render:function render(){return React.createElement(EmployeeAssignmentPage,{employee:employee,active_section:active_section,handleAssignment:_this2.handleAssignment,handleDelete:_this2.handleDelete,assignment:page_assignment,updateAssignmentInAssignmentPage:_this2.updateAssignmentInAssignmentPage,createAndUpdateAssignment:_this2.createAndUpdateAssignment,handleAssignmentComments:_this2.handleAssignmentComments});}})));}}]);return EmploeeAssignments;}(Component);function mapStateToProps(_ref4){var employees=_ref4.employees,navbar=_ref4.navbar,assignments=_ref4.assignments,user=_ref4.user,global=_ref4.global;return{employees:employees,navbar:navbar,assignments:assignments,user:user,global:global};}export default withRouter(connect(mapStateToProps,actions)(EmploeeAssignments));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/components/employee-page/employee-assignments/EmploeeAssignments.jsx"],"names":["React","Component","connect","actions","apiGetRequest","apiPostRequest","EmployeeTodoList","withRouter","BrowserRouter","Router","Route","Switch","EMPLOYEE_ROUTE","EMPLOYEE_ASSIGNMENT_ROUTE","EMPLOYEE_DASHBOARD_PAGE_ROUTE","EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE","EmployeeAssignmentPage","HandleAssignment","AssignmentComments","PopupWithFunction","EmploeeAssignments","getAssignments","api","res","ok","setState","assignments_list","result","assignments_loaded","handleAssignment","action","new_assignment","assignment_to_edit","handle_assignment","createAndUpdateAssignment","assignment","employee","props","_id","status","console","log","index","assignments","findIndex","m","updated_employee","JSON","parse","stringify","splice","updateGlobalReducer","unshift","updateParentState","url","window","location","pathname","indexOf","updateAssignmentInAssignmentPage","handleDelete","assignment_to_remove","handleAssignmentComments","assignment_comments","remove","state","delete_loading","updated","updateEmployee","close","history","push","replace","setTimeout","page_assignment","updateState","name","value","system_text","global","active_section","hide_page","user","opacity","transition","REMOVE_ASSIGNMENT_QUESTION","title","YES","NO","is_manager","mapStateToProps","employees","navbar"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"../../../actions/actions\";\nimport { apiGetRequest, apiPostRequest } from \"../../../tools/api\";\nimport EmployeeTodoList from \"./EmployeeTodoList\";\nimport { withRouter } from \"react-router\";\nimport { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\nimport {\n  EMPLOYEE_ROUTE,\n  EMPLOYEE_ASSIGNMENT_ROUTE,\n  EMPLOYEE_DASHBOARD_PAGE_ROUTE,\n  EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE,\n} from \"../../../tools/routes\";\nimport EmployeeAssignmentPage from \"../employee-assignment-page/EmployeeAssignmentPage\";\nimport HandleAssignment from \"../../assignments/parts/HandleAssignment\";\nimport AssignmentComments from \"../parts/AssignmentComments\";\nimport PopupWithFunction from \"../../../parts/PopupWithFunction\";\n\nclass EmploeeAssignments extends Component {\n  constructor() {\n    super();\n    this.state = {};\n  }\n\n  async componentDidMount() {\n    this.getAssignments();\n  }\n\n  getAssignments = async () => {\n    const api = \"assignment\";\n    const res = await apiGetRequest(api);\n    if (res.ok) {\n      this.setState({\n        assignments_list: res.result,\n        assignments_loaded: true,\n      });\n    }\n  };\n\n \n  handleAssignment = (action, new_assignment, assignment_to_edit) => {\n    this.setState({\n      handle_assignment: action,\n      new_assignment,\n      assignment_to_edit,\n    });\n  };\n\n  createAndUpdateAssignment = async (assignment) => {\n    const { employee } = this.props;\n    const api = `employee_assignment`;\n    assignment[\"employee_id\"] = employee._id;\n    assignment[\"status\"] = assignment.status ? assignment.status : \"pending\";\n    console.log(assignment);\n    const res = await apiPostRequest(api, assignment);\n    if (res.ok) {\n      let index = employee.assignments.findIndex(\n        (m) => m._id == assignment._id\n      );\n      let updated_employee = JSON.parse(JSON.stringify(employee))\n      if (index >= 0) {\n        updated_employee.assignments.splice(index, 1, res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment updated\");\n      } else {\n        updated_employee.assignments.unshift(res.result);\n        this.props.updateGlobalReducer(\"success\", \"Assignment created\");\n      }\n      this.props.updateParentState('employee',updated_employee);\n      const url = window.location.pathname\n      if(url.indexOf('assignment') > -1){\n        this.updateAssignmentInAssignmentPage(res.result)\n    }\n    }\n  };\n\n  handleDelete = (assignment_to_remove) => {\n    console.log(assignment_to_remove);\n    this.setState({\n      assignment_to_remove,\n    });\n  };\n  handleAssignmentComments = (assignment_comments) => {\n    this.setState({\n      assignment_comments,\n    });\n  };\n\n  remove = async () => {\n    const { assignment_to_remove } = this.state;\n    const { employee } = this.props;\n    this.setState({\n      delete_loading:true\n    })\n    assignment_to_remove[\"employee_id\"] = employee._id;\n    const api = \"employee_assignment/delete\";\n    const res = await apiPostRequest(api, assignment_to_remove);\n    if (res.ok) {\n      let updated = { ...employee };\n      let index = updated.assignments.findIndex(\n        (m) => m._id == assignment_to_remove._id\n      );\n      if (index >= 0) {\n        updated.assignments.splice(index, 1);\n        this.props.updateEmployee(updated);\n        this.close();\n      }\n      const url = window.location.pathname\n      if(url.indexOf('assignment') === 0){\n          this.props.history.push(EMPLOYEE_ROUTE.replace(':id', employee._id))\n      }\n    }\n  setTimeout(() => {\n    this.setState({\n      delete_loading:false\n    })\n  }, 300);\n  };\n\n  close = () => {\n    this.handleDelete();\n  };\n\n\nupdateAssignmentInAssignmentPage = (page_assignment) => {\n    this.setState({\n        page_assignment\n    })\n}\nupdateState = (name, value) => {\n    this.setState({\n        [name]:value\n    })\n}\n\n  render() {\n    const {\n      assignments_list,\n      assignments_loaded,\n      assignment_comments,\n      handle_assignment,\n      new_assignment,\n      assignment_to_edit,\n      assignment_to_remove,\n      page_assignment,\n      delete_loading\n    } = this.state;\n    const {system_text} = this.props.global\n    const { active_section, employee, hide_page } = this.props;\n    const {user} = this.props.user\n    return (\n      <div   \n      style ={{\n        opacity:hide_page ? 0 : 1,\n        transition:'0.2s all'\n      }}>\n      <PopupWithFunction\n          text={system_text.REMOVE_ASSIGNMENT_QUESTION}\n          name={`${assignment_to_remove ? assignment_to_remove.title : \"\"}?`}\n          active={assignment_to_remove}\n          submit={this.remove}\n          close={this.close}\n          submit_text={system_text.YES}\n          close_text={system_text.NO}\n          loading = {delete_loading}\n        />\n        {assignment_comments ? (\n          <AssignmentComments\n            updateAssignment={this.createAndUpdateAssignment}\n            assignment={assignment_comments}\n            updateParentState={this.updateState}\n            system_text = {system_text}\n          />\n        ) : (\n          \"\"\n        )}\n        {handle_assignment ? (\n          <HandleAssignment\n            new_assignment={new_assignment}\n            edit={this.createAndUpdateAssignment}\n            create={this.createAndUpdateAssignment}\n            assignment_to_edit={assignment_to_edit}\n            toggleHandleAssignment={this.handleAssignment}\n            from_employee_page={true}\n            handleDelete = {this.handleDelete}\n            assignments_list = {assignments_list}\n           \n          />\n        ) : null}\n\n        <Switch>\n          <Route\n            exact\n            path={user.is_manager ? EMPLOYEE_ROUTE   : EMPLOYEE_DASHBOARD_PAGE_ROUTE}\n            render={() => (\n              <EmployeeTodoList\n                handleAssignmentComments={this.handleAssignmentComments}\n                handleAssignment={this.handleAssignment}\n                updateEmployee={this.updateEmployee}\n                employee={employee ? employee : {}}\n                assignments_loaded={assignments_loaded}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleDelete = {this.handleDelete}\n              />\n            )}\n          />\n          <Route\n           exact\n            path={user.is_manager ? EMPLOYEE_ASSIGNMENT_ROUTE : EMPLOYEE_DASHBOARD_ASSIGNMENT_ROUTE}\n            render={() => (\n              <EmployeeAssignmentPage\n                employee={employee}\n                active_section={active_section}\n                handleAssignment={this.handleAssignment}\n                handleDelete = {this.handleDelete}\n                assignment = {page_assignment}\n                updateAssignmentInAssignmentPage = {this.updateAssignmentInAssignmentPage}\n                createAndUpdateAssignment = {this.createAndUpdateAssignment}\n                handleAssignmentComments = {this.handleAssignmentComments}\n              />\n            )}\n          />\n        </Switch>\n      </div>\n    );\n  }\n}\n\nfunction mapStateToProps({ employees, navbar, assignments, user, global }) {\n  return { employees, navbar, assignments, user , global};\n}\n\nexport default withRouter(\n  connect(mapStateToProps, actions)(EmploeeAssignments)\n);\n"]},"metadata":{},"sourceType":"module"}