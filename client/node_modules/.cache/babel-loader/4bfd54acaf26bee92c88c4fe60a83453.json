{"ast":null,"code":"import _regeneratorRuntime from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/denis/Desktop/projects/todo/front/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from\"react\";import{BrowserRouter as Router,Route,Switch,withRouter}from\"react-router-dom\";import{DASHBOARD_ROUTE,LOGIN_ROUTE,SIGNUP_ROUTE,EMPLOYEE_DASHBOARD_ROUTE,EMPLOYEES_ROUTE,EMPLOYEE_DASHBOARD_PAGE_ROUTE}from\"./tools/routes\";import Dashboard from\"./components/dashboard/Dashboard\";import{connect}from\"react-redux\";import*as actions from\"./actions/actions\";import EmployeeDashboard from\"./components/employee-dashboard/EmployeeDashboard\";import ErrorPopup from\"./parts/ErrorPopUp\";import SuccessPopup from\"./parts/SuccessPopup\";import{AUTH_TOKEN}from\"./tools/keys\";import{LoginWithJwt}from\"./functions/auth_functions\";import{getCookie}from\"./tools/cookie\";import SignInForm from\"./components/login/parts/SignInForm\";import SignUpForm from\"./components/login/parts/SignUpForm\";import InvalidRoute from\"./components/invalid-route/InvalidRoute\";import{apiGetRequest}from\"./tools/api\";var App=/*#__PURE__*/function(_Component){_inherits(App,_Component);function App(){var _this;_classCallCheck(this,App);_this=_possibleConstructorReturn(this,_getPrototypeOf(App).call(this));_this.handleNoAccessRoutes=function(url){if(url.indexOf(\"login\")===-1&&url.indexOf(\"signup\")===-1){_this.props.history.push(LOGIN_ROUTE);}};_this.handleUserRouting=function(user,url){if(!url.split('/')[1]){if(user.is_manager)return _this.props.history.push(EMPLOYEES_ROUTE);else return _this.props.history.push(EMPLOYEE_DASHBOARD_PAGE_ROUTE.replace(':id',user._id));}};_this.close=function(){_this.props.updateGlobalReducer(\"error\",false);_this.props.updateGlobalReducer(\"success\",false);};_this.state={};return _this;}_createClass(App,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var token,url,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getCookie(AUTH_TOKEN);case 2:token=_context.sent;url=window.location.pathname;if(!token){_context.next=11;break;}_context.next=7;return LoginWithJwt();case 7:user=_context.sent;if(user){this.props.updateUserReducer(\"user\",user);this.handleUserRouting(user,url);}_context.next=12;break;case 11:this.handleNoAccessRoutes(url);case 12:this.setState({page_loaded:true});case 13:case\"end\":return _context.stop();}}},_callee,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"render\",value:function render(){var _this$props$global=this.props.global,error=_this$props$global.error,success=_this$props$global.success;var user=this.props.user.user;var page_loaded=this.state.page_loaded;return page_loaded?React.createElement(\"div\",null,React.createElement(SuccessPopup,{active:true,msg:success,close:this.close}),React.createElement(ErrorPopup,{active:true,error:error,close:this.close}),React.createElement(Switch,null,user&&user._id?React.createElement(Route,{path:DASHBOARD_ROUTE,render:function render(){return React.createElement(Dashboard,null);}}):null,React.createElement(Route,{path:LOGIN_ROUTE,render:function render(){return React.createElement(SignInForm,null);}}),React.createElement(Route,{path:SIGNUP_ROUTE,render:function render(){return React.createElement(SignUpForm,null);}}),user&&user._id?React.createElement(Route,{path:EMPLOYEE_DASHBOARD_ROUTE,render:function render(){return React.createElement(EmployeeDashboard,null);}}):null,React.createElement(Route,{path:\"*\",exact:true,component:InvalidRoute}))):'';}}]);return App;}(Component);function mapStateToProps(_ref){var router=_ref.router,user=_ref.user,global=_ref.global;return{router:router,user:user,global:global};}export default withRouter(connect(mapStateToProps,actions)(App));","map":{"version":3,"sources":["/Users/denis/Desktop/projects/todo/front/client/src/App.jsx"],"names":["React","Component","BrowserRouter","Router","Route","Switch","withRouter","DASHBOARD_ROUTE","LOGIN_ROUTE","SIGNUP_ROUTE","EMPLOYEE_DASHBOARD_ROUTE","EMPLOYEES_ROUTE","EMPLOYEE_DASHBOARD_PAGE_ROUTE","Dashboard","connect","actions","EmployeeDashboard","ErrorPopup","SuccessPopup","AUTH_TOKEN","LoginWithJwt","getCookie","SignInForm","SignUpForm","InvalidRoute","apiGetRequest","App","handleNoAccessRoutes","url","indexOf","props","history","push","handleUserRouting","user","split","is_manager","replace","_id","close","updateGlobalReducer","state","token","window","location","pathname","updateUserReducer","setState","page_loaded","global","error","success","mapStateToProps","router"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport {\n  BrowserRouter as Router,\n  Route,\n  Switch,\n  withRouter,\n} from \"react-router-dom\";\nimport {\n  DASHBOARD_ROUTE,\n  LOGIN_ROUTE,\n  SIGNUP_ROUTE,\n  EMPLOYEE_DASHBOARD_ROUTE,\n  EMPLOYEES_ROUTE,\n  EMPLOYEE_DASHBOARD_PAGE_ROUTE,\n} from \"./tools/routes\";\nimport Dashboard from \"./components/dashboard/Dashboard\";\nimport { connect } from \"react-redux\";\nimport * as actions from \"./actions/actions\";\nimport EmployeeDashboard from \"./components/employee-dashboard/EmployeeDashboard\";\nimport ErrorPopup from \"./parts/ErrorPopUp\";\nimport SuccessPopup from \"./parts/SuccessPopup\";\nimport { AUTH_TOKEN } from \"./tools/keys\";\nimport { LoginWithJwt } from \"./functions/auth_functions\";\nimport { getCookie } from \"./tools/cookie\";\nimport SignInForm from \"./components/login/parts/SignInForm\";\nimport SignUpForm from \"./components/login/parts/SignUpForm\";\nimport InvalidRoute from \"./components/invalid-route/InvalidRoute\";\nimport { apiGetRequest } from \"./tools/api\";\n\n\n\n\n\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {};\n  }\n  async componentDidMount() {\n    const token = await getCookie(AUTH_TOKEN);\n    const url = window.location.pathname;\n    if (token) {\n      const user = await LoginWithJwt();\n      if (user) {\n        this.props.updateUserReducer(\"user\", user);\n     \n        this.handleUserRouting(user, url);\n      }\n    } else this.handleNoAccessRoutes(url);\n\n    this.setState({\n      page_loaded:true\n    })\n  }\n\n  handleNoAccessRoutes = (url) => {\n    if (url.indexOf(\"login\") === -1 && url.indexOf(\"signup\") === -1) {\n      this.props.history.push(LOGIN_ROUTE);\n    }\n  };\n\n  handleUserRouting = (user, url) => {\n    if(!url.split('/')[1]){\n      if (user.is_manager) return this.props.history.push(EMPLOYEES_ROUTE);\n      else\n        return this.props.history.push(\n          EMPLOYEE_DASHBOARD_PAGE_ROUTE.replace(':id', user._id)\n        );\n    }\n  \n  };\n\n  close = () => {\n    this.props.updateGlobalReducer(\"error\", false);\n    this.props.updateGlobalReducer(\"success\", false);\n  };\n  render() {\n    const { error, success } = this.props.global;\n \n    const { user } = this.props.user;\n    const {page_loaded} = this.state\n    return (\n      page_loaded ? <div>\n        <SuccessPopup active msg={success} close={this.close} />\n        <ErrorPopup active error={error} close={this.close} />\n        <Switch>\n          {user && user._id ? (\n            <Route path={DASHBOARD_ROUTE} render={() => <Dashboard />} />\n          ) : null}\n          <Route path={LOGIN_ROUTE} render={() => <SignInForm />} />\n          <Route path={SIGNUP_ROUTE} render={() => <SignUpForm />} />\n          {user && user._id ? (\n            <Route\n              path={EMPLOYEE_DASHBOARD_ROUTE}\n              render={() => <EmployeeDashboard />}\n            />\n          ) : null}\n          <Route path='*' exact={true} component={InvalidRoute} />\n        </Switch>\n      </div>  :''\n    );\n  }\n}\n\nfunction mapStateToProps({ router, user, global }) {\n  return { router, user, global };\n}\n\nexport default withRouter(connect(mapStateToProps, actions)(App));\n"]},"metadata":{},"sourceType":"module"}